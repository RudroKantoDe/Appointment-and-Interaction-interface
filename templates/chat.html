{% extends 'base.html' %}
{% block content %}

<h4 class="mb-3 text-center">Chat - Appointment #{{ appointment.id }}</h4>

<div id="chat-box" class="border p-3 mb-3 bg-white" style="height: 300px; overflow-y: auto;">
  {% for msg in messages %}
    <div class="p-2 mb-2 rounded" 
         style="background-color: {% if msg.sender == 'doctor' %}#d1e7dd{% else %}#cfe2ff{% endif %};">
      <strong>{{ msg.sender.capitalize() }}:</strong>
      {{ msg.content }}
      <small class="text-muted" style="font-size: 12px; float: right;">{{ msg.timestamp.strftime("%H:%M") }}</small>
    </div>
  {% endfor %}
</div>

<form method="POST" class="d-flex gap-2">
  <input type="text" name="message" class="form-control" placeholder="Type message..." required>
  <button class="btn btn-primary">Send</button>
</form>

<script>
  // Auto-scroll to the bottom on page load
  const chatBox = document.getElementById('chat-box');
  chatBox.scrollTop = chatBox.scrollHeight;

  // Auto-refresh chat every 3 seconds
  setInterval(() => { location.reload(); }, 3000);
</script>

{% endblock %}
